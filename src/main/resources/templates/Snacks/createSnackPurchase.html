<!DOCTYPE html>
<html lang="es" xmlns:c="https://jakarta.ee/xml/ns/jakartaee">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compra de Snacks</title>
</head>
<body>
<h1>Compra de Snacks</h1>

<!-- Mensajes de error si existen -->
<c:if test="${not empty error}">
    <div style="color: red;">${error}</div>
</c:if>

<!-- Formulario de selección de snacks -->
<form action="/create" method="POST">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <h2>Selecciona tus snacks y cantidades</h2>
    <div>
        <c:forEach items="${snacks}" var="snack">
            <div>
                <label>
                    <input type="checkbox" name="snackIds" value="${snack.id}" /> ${snack.name} - $${snack.price}
                </label>
                <input type="number" name="snackQuantities" value="1" min="1" />
            </div>
        </c:forEach>
    </div>

    <button type="submit">Agregar al carrito</button>
</form>

<!-- Si ya hay una selección de snacks, muestra el carrito -->
<c:if test="${not empty cart}">
    <h3>Tu carrito:</h3>
    <table>
        <thead>
        <tr>
            <th>Snack</th>
            <th>Cantidad</th>
            <th>Precio</th>
            <th>Total</th>
        </tr>
        </thead>
        <tbody>
        <c:forEach items="${cart}" var="cartItem">
            <tr>
                <td>${cartItem.name}</td>
                <td>${cartItem.quantity}</td>
                <td>$${cartItem.price}</td>
                <td>$${cartItem.totalPrice}</td>
            </tr>
        </c:forEach>
        </tbody>
    </table>

    <h3>Total: $${totalPrice}</h3>
</c:if>

<!-- Botones para confirmar o cancelar -->
<form action="/confirmPurchase" method="POST">
    <button type="submit">Confirmar compra</button>
</form>

<form action="/cancelPurchase" method="POST">
    <button type="submit">Cancelar compra</button>
</form>

</body>
</html>